# FDA Watch — Complete Build Guide

## From Zero to Phone App: Step-by-Step

**Starting point:** Drug adverse events (one endpoint, one topic).
**End goal:** A working chat app on your phone backed by real FDA data.

---

## Phase 1: Get Your Data Pipeline Running (R)

### Step 1.1 — Get an openFDA API Key

1. Go to **https://open.fda.gov/apis/authentication/**
2. Enter your email address
3. They'll email you a key instantly — it's a long string of letters and numbers
4. This bumps your rate limit from 40 to 240 requests per minute (free)

### Step 1.2 — Install R Packages

Open R or RStudio and run once:

```r
install.packages(c("httr2", "jsonlite", "dplyr", "purrr", "lubridate"))
```

### Step 1.3 — Run the Pipeline Script

1. Open the file `fda_pipeline.R` (provided with this guide)
2. Paste your API key into the `API_KEY` line near the top
3. Run the entire script

It will:
- Pull the top 25 most-reported adverse reactions across all drugs
- Pull the top 20 drugs by adverse event volume
- Pull serious vs non-serious outcome stats
- Pull reports by country
- Pull detailed profiles for 9 common drugs (metformin, aspirin, ibuprofen, etc.)
- Write everything as JSON files into a `data/` folder

**What you'll see in the `data/` folder:**

```
data/
  summary.json           ← Overall stats for the chat's general knowledge
  drug_metformin.json    ← Drug-specific profile
  drug_aspirin.json
  drug_ibuprofen.json
  ... (one per drug)
```

### Step 1.4 — Verify It Worked

Open `data/summary.json` in any text editor. You should see something like:

```json
{
  "generated": "2026-02-14T...",
  "top_reactions": [
    { "reaction": "NAUSEA", "count": 284102, "pct_of_max": 100 },
    { "reaction": "FATIGUE", "count": 231847, "pct_of_max": 82 },
    ...
  ]
}
```

If you see data, Phase 1 is done.

---

## Phase 2: Set Up GitHub

### Step 2.1 — Create a GitHub Account

1. Go to **https://github.com** and sign up (free)
2. You'll use this for hosting your code AND deploying the app

### Step 2.2 — Create a New Repository

1. Click the green **"New"** button (top left of GitHub dashboard)
2. Name it `fda-watch`
3. Set it to **Public** (needed for free GitHub Pages hosting)
4. Check **"Add a README file"**
5. Click **"Create repository"**

### Step 2.3 — Upload Your Files

For now, the simplest approach (no Git command line needed):

1. In your new repository on GitHub, click **"Add file" → "Upload files"**
2. Drag in:
   - `fda_pipeline.R` (your R script)
   - The `data/` folder with all JSON files
   - `index.html` (the chat app file — we'll build the production version next)
3. Click **"Commit changes"**

Later, when you're comfortable, you can install Git on your computer for
easier updates. But uploading through the browser works perfectly fine to start.

---

## Phase 3: Build the Production Chat App

### Step 3.1 — How It Works

The chat app is a single HTML file that:
1. Loads your pre-processed JSON data files on startup
2. Presents a chat interface with text and voice input
3. When the user asks a question, sends it to the Gemini API along
   with relevant data from your JSON files as context
4. Displays the AI's response with data cards and charts

### Step 3.2 — Get a Gemini API Key

1. Go to **https://aistudio.google.com/apikey**
2. Sign in with your Google account
3. Click **"Create API key"**
4. Copy the key — this is what powers the AI chat responses
5. The free tier gives you up to 1,000 requests per day

### Step 3.3 — The App Structure

Your repository will look like this:

```
fda-watch/
  index.html            ← The main app (chat interface + PWA)
  data/
    summary.json        ← Generated by your R script
    drug_metformin.json
    drug_aspirin.json
    ...
  fda_pipeline.R        ← Your R data pipeline
  .github/
    workflows/
      update-data.yml   ← Automatic weekly data refresh (Phase 5)
```

### Step 3.4 — Important: Where the API Key Goes

Your Gemini API key should NOT be in the HTML file that gets deployed.
For the prototype/small-scale version, you have two options:

**Option A (simplest, fine for <100 users):**
Put the key in the JavaScript. Yes, it's visible to anyone who views source,
but Gemini's free tier has rate limits that protect you from abuse.
This is how most indie projects start.

**Option B (better, for when you grow):**
Use a tiny serverless function (Cloudflare Workers, free tier) that
holds the key server-side. The app calls your worker, which calls Gemini.
Users never see the key. We can set this up later.

---

## Phase 4: Deploy to GitHub Pages

### Step 4.1 — Enable GitHub Pages

1. In your repository, go to **Settings** (tab at the top)
2. Scroll down to **"Pages"** in the left sidebar
3. Under "Source", select **"Deploy from a branch"**
4. Set branch to **main** and folder to **/ (root)**
5. Click **Save**

### Step 4.2 — Wait 2 Minutes

GitHub will build and deploy your site. After a couple of minutes:

- Your app is live at: **https://YOUR-USERNAME.github.io/fda-watch/**
- This URL works on phone, tablet, and desktop

### Step 4.3 — Add It to Your Phone's Home Screen

**On iPhone (Safari):**
1. Open the URL in Safari
2. Tap the Share button (square with arrow)
3. Scroll down and tap **"Add to Home Screen"**
4. It now appears as an app icon — opens full-screen like a native app

**On Android (Chrome):**
1. Open the URL in Chrome
2. Tap the three-dot menu
3. Tap **"Add to Home screen"** or **"Install app"**
4. Same deal — it's now an app on your phone

### Step 4.4 — Custom Domain (Optional, ~$12/year)

If you want `fdawatch.app` instead of the GitHub URL:

1. Buy a domain from Cloudflare Registrar (cheapest) or Namecheap
2. In your GitHub repo Settings → Pages → Custom domain
3. Enter your domain name
4. Add the DNS records GitHub tells you to (A records and CNAME)
5. Wait 15-30 minutes for DNS to propagate

---

## Phase 5: Automate Weekly Data Updates

### Step 5.1 — GitHub Actions (Free Automation)

Create a file at `.github/workflows/update-data.yml` in your repo:

```yaml
name: Update FDA Data

on:
  schedule:
    - cron: '0 6 * * 1'  # Every Monday at 6am UTC
  workflow_dispatch:       # Also allows manual trigger

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      - name: Install R packages
        run: |
          Rscript -e 'install.packages(c("httr2","jsonlite","dplyr","purrr","lubridate"))'

      - name: Run data pipeline
        env:
          FDA_API_KEY: ${{ secrets.FDA_API_KEY }}
        run: Rscript fda_pipeline.R

      - name: Commit updated data
        run: |
          git config user.name "FDA Watch Bot"
          git config user.email "bot@fdawatch.app"
          git add data/
          git diff --staged --quiet || git commit -m "Update FDA data $(date +%Y-%m-%d)"
          git push
```

### Step 5.2 — Add Your API Key as a Secret

1. In your repo, go to **Settings → Secrets and variables → Actions**
2. Click **"New repository secret"**
3. Name: `FDA_API_KEY`
4. Value: paste your openFDA API key
5. Click **Add secret**

Then modify the R script to read the key from environment:

```r
API_KEY <- Sys.getenv("FDA_API_KEY", unset = "")
```

Now every Monday, GitHub automatically runs your R script, updates the
JSON data files, and redeploys the site. You don't touch anything.

---

## Phase 6: Expand to More Topics

Once the drug adverse events app is working, repeat the pattern:

### Next endpoint: Food Recalls

```r
# Add to your R pipeline:
food_recalls <- fda_query(
  endpoint = "/food/enforcement.json",
  search = 'status:"Ongoing"',
  limit = 50
)
```

### Then: Medical Device Events

```r
device_events <- fda_query(
  endpoint = "/device/event.json",
  count = "device.generic_name.exact",
  limit = 20
)
```

### Then: Drug Labels (dosing information)

```r
drug_label <- fda_query(
  endpoint = "/drug/label.json",
  search = 'openfda.generic_name.exact:"METFORMIN"',
  limit = 1
)
```

Each new endpoint adds a new capability to the chat. The app's AI
can answer more types of questions as you add more data sources.

---

## Monetization Setup (When You're Ready)

### Affiliate Links — GoodRx

1. Go to **https://www.goodrx.com/corporate/partners** or search
   "GoodRx affiliate program"
2. Apply (they accept most health-related sites)
3. They give you a unique tracking URL pattern
4. In the chat app, when showing drug info, add a line like:
   "Compare prices for metformin → [GoodRx link]"
5. You earn a commission when someone uses a coupon through your link

### Freemium Tier (Later)

When traffic justifies it, add a Pro tier ($3.99/month) that includes:
- Custom drug watchlists with change alerts
- Historical trend analysis (5-year charts)
- PDF report export
- Multi-drug comparison tool
- No usage limits on chat queries

Implement payments via Stripe (2.9% + 30¢ per transaction).

---

## Quick Reference

| What | Where |
|------|-------|
| openFDA API docs | https://open.fda.gov |
| openFDA API base | https://api.fda.gov |
| Get FDA API key | https://open.fda.gov/apis/authentication/ |
| Get Gemini API key | https://aistudio.google.com/apikey |
| Gemini API pricing | https://ai.google.dev/gemini-api/docs/pricing |
| GitHub Pages docs | https://pages.github.com |
| R openFDA package | https://simpar1471.github.io/openFDA/ |

---

## Troubleshooting

**R script gives "429 Too Many Requests":**
You're hitting the rate limit. Add `Sys.sleep(1)` between API calls,
or get an API key if you haven't already.

**GitHub Pages shows 404:**
Make sure your main HTML file is named `index.html` (not `fda-watch.html`)
and is in the root of the repository, not inside a subfolder.

**Voice input doesn't work:**
Web Speech API only works in Chrome (and Chromium-based browsers).
Safari on iOS has partial support. Firefox doesn't support it.
Make sure the site is served over HTTPS (GitHub Pages does this automatically).

**Gemini API returns errors:**
Check your API key is correct. The free tier has a limit of 15 requests
per minute — if you exceed this, add a brief delay between requests.
The app should show a friendly "I'm thinking..." message rather than
exposing raw errors.
